!function(a){"function"==typeof define&&define.amd?define(["view","util","events","zepto"],a):a(View,window.util,window.EventEmitter,$,window.View)}(function(a,b,c,d){function e(a){"string"==typeof a&&(l=d(a),l.addClass("stage"))}function f(a,b){return a.stage?!1:(l.append(a.base),a.stage=k,a.stageOptions=b,!0)}function g(a,b,c,d){c?(a.base.hasClass(b+"-out")||a.base.addClass(b+"-out"),a.base.addClass("staged"),setTimeout(function(){a.base.removeClass(b+"-out"),d&&d()},15)):(a.base.addClass(b+"-out"),setTimeout(function(){a.base.removeClass("staged"),d&&d()},500))}function h(a){o?o.stageOptions&&o.stageOptions.animation?g(o,o.stageOptions.animation,!1,a):(o.base.removeClass("staged"),a&&a()):a&&a()}function i(a,b){function c(a){"string"==typeof a&&d(a).append('<div id="overlay"><div id="spinner"></div></div>')}function e(){d("#overlay").remove()}n=!0,c("#main");Date.now();h(function(){a.stageOptions&&a.stageOptions.animation?g(a,a.stageOptions.animation,!0,function(){o=a,n=!1,e("div"),b&&b()}):(a.base.addClass("staged"),o=a,n=!1,e("div"),b&&b())})}function j(a){function b(){m.length&&m.pop()()}n||m.length?m.push(i.bind(k,a,b)):i(a,b)}var k=new c,l=null,m=[],n=!1,o=null,p=!1;return b.extend(k,{init:function(a){return a.container?(e(a.container),void(p=!0)):!1},show:function(b,c){return p?(b instanceof a&&(c=b,b=null),b=b||c.stageOptions||{animation:!1},c&&c.base?(c.stage||f(c,b),void j(c)):!1):!1},hide:function(a,b){return p?(a instanceof b&&(b=a,a=null),a=a||!1,b&&b.base?o!==b.base?!1:void h(a):!1):!1}}),k});